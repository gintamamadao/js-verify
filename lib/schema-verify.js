"use strict";function r(t){return(r="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(r){return typeof r}:function(r){return r&&"function"==typeof Symbol&&r.constructor===Symbol&&r!==Symbol.prototype?"symbol":typeof r})(t)}function t(r,t){if(!(r instanceof t))throw new TypeError("Cannot call a class as a function")}function n(r,t){for(var n=0;t.length>n;n++){var e=t[n];e.enumerable=e.enumerable||!1,e.configurable=!0,"value"in e&&(e.writable=!0),Object.defineProperty(r,e.key,e)}}function e(r,t,e){return t&&n(r.prototype,t),e&&n(r,e),r}function i(r,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function");r.prototype=Object.create(t&&t.prototype,{constructor:{value:r,writable:!0,configurable:!0}}),t&&a(r,t)}function o(r){return(o=Object.setPrototypeOf?Object.getPrototypeOf:function(r){return r.__proto__||Object.getPrototypeOf(r)})(r)}function a(r,t){return(a=Object.setPrototypeOf||function(r,t){return r.__proto__=t,r})(r,t)}function u(r,t){return!t||"object"!=typeof t&&"function"!=typeof t?function(r){if(void 0===r)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return r}(r):t}Object.defineProperty(exports,"__esModule",{value:!0});var c=function(t){return null!=t&&"object"===r(t)&&!1===Array.isArray(t)},s=function(r){return"[object Array]"==Object.prototype.toString.call(r)},f=function(r){return"string"==typeof r},l=function(r){return"number"==typeof r&&!Number.isNaN(r)&&function(r){return r!==1/0&&r!==-1/0}(r)},y=function(r){return l(r)&&Math.floor(r)===r},p=function(r){return"function"==typeof r},m=function(r){return null===r},b=function(r){return void 0===r},h=function(r){return null==r},w={string:{is:function(r){return f(r)},isNot:function(r){return!f(r)},isEmpty:function(r){return f(r)&&0===r.length},isNotEmpty:function(r){return f(r)&&r.length>=1},safe:function(r){return f(r)?r:h(r)?"":r+""}},number:{is:function(r){return l(r)},isNot:function(r){return!l(r)},isInteger:function(r){return l(r)&&y(r)},isNatural:function(r){return l(r)&&y(r)&&r>=0},safe:function(r){return l(r)?r:h(r)?0:(r=new Number(r).valueOf(),l(r)?r:0)}},boolean:{is:function(r){return!0===r||!1===r},isNot:function(r){return!0!==r&&!1!==r}},array:{is:function(r){return s(r)},isNot:function(r){return!s(r)},isEmpty:function(r){return s(r)&&0===r.length},isNotEmpty:function(r){return s(r)&&r.length>=1},safe:function(r){return s(r)?r:[]},pure:function(r){if(!s(r))return[];var t=[];return r.forEach((function(r){h(r)||t.push(r)})),t}},object:{is:function(r){return c(r)},isNot:function(r){return!c(r)},isEmpty:function(r){return c(r)&&0===Object.keys(r).length},isNotEmpty:function(r){return c(r)&&Object.keys(r).length>=1},safe:function(r){return c(r)?r:{}},pure:function(r){if(!c(r))return{};var t=Object.assign({},r);return Object.keys(t).forEach((function(r){h(t[r])&&delete t[r]})),t}},func:{is:function(r){return p(r)},isNot:function(r){return!p(r)},safe:function(r,t){return function(){if(p(r))return t=t||m(t)?t:this,r.apply(t,Array.prototype.slice.apply(arguments))}}},undefinedNull:{is:function(r){return h(r)},isNot:function(r){return!h(r)}},nul:{is:function(r){return m(r)},isNot:function(r){return!m(r)}},undefined:{is:function(r){return b(r)},isNot:function(r){return!b(r)}}},E=new RegExp(/^1\d{10}$/),v=new RegExp(/^[a-zA-Z0-9_-]+@[a-zA-Z0-9_-]+(\.[a-zA-Z0-9_-]+)+$/),g=new RegExp(/(^#\w{3}$)|(^#\w{6}$)|(^rgb\s*\((\s*\d{1,3}\s*,){2}\s*\d{1,3}\s*\)$)|(^rgba\s*\((\s*\d{1,3}\s*,){3},[01]{1}\.?\d*\s*\)$)/),N=new RegExp(/(^[vV]\d+$)|(^[vV]((\d+\.)+)(\d+)$)/),d=new RegExp(/^[a-zA-Z_][a-zA-Z_\d]*$/),j=new RegExp(/^\d+$/),O=new RegExp(/^\d{4}-\d{2}-\d{2} \d{2}:\d{2}(:\d{2})?/),H={phone:{is:function(r){return w.string.isNotEmpty(r)&&E.test(r)}},uri:{is:function(r){try{return w.string.isNotEmpty(r)&&w.object.is(new URL(r))}catch(r){return!1}}},email:{is:function(r){return w.string.isNotEmpty(r)&&v.test(r)}},color:{is:function(r){return w.string.isNotEmpty(r)&&g.test(r)}},version:{is:function(r){return w.string.isNotEmpty(r)&&N.test(r)}},sign:{is:function(r){return w.string.isNotEmpty(r)&&d.test(r)}},numStr:{is:function(r){return w.string.isNotEmpty(r)&&j.test(r)}},jsonStr:{is:function(r){try{return w.string.isNotEmpty(r)&&JSON.parse(r)}catch(r){return!1}}},time:{is:function(r){var t=new Date(r);return w.object.is(t)&&"Invalid Date"!==t.toString()},isCommon:function(r){return w.string.isNotEmpty(r)&&O.test(r)}}},P=function(){function r(){t(this,r)}return e(r,[{key:"safeErrorHint",value:function(r){return"string"==typeof r?r:r&&r.message?r.message:"未知"}}]),r}(),k=new(function(r){function n(){var r;return t(this,n),(r=u(this,o(n).call(this))).propEmptyHint="对象缺少属性",r.elementEmptyHint="数组缺少元素",r.propErrorHint=function(t,n){return"属性 ".concat(t,": ").concat(r.safeErrorHint(n))},r.elementErrorHint=function(t,n){return"第 ".concat(t," 项: ").concat(r.safeErrorHint(n))},r}return i(n,P),e(n,[{key:"minValueHint",value:function(r){return"小于最小值 ".concat(r)}},{key:"maxValueHint",value:function(r){return"大于最大值 ".concat(r)}},{key:"minLenHint",value:function(r){return"小于最小长度 ".concat(r)}},{key:"maxLenHint",value:function(r){return"大于最大长度 ".concat(r)}},{key:"typeNeedHint",value:function(r){return"需要 ".concat(r," 类型")}},{key:"enumHint",value:function(r){return"".concat(r," 不是有效值之一")}},{key:"integerHint",value:function(r){return"".concat(r," 不是整数")}},{key:"naturalHint",value:function(r){return"".concat(r," 不是自然数")}},{key:"matchHint",value:function(r){return"".concat(r," 未通过正则规则")}},{key:"patternNeedHint",value:function(r){return"需要 ".concat(r," 格式")}},{key:"propNeedHint",value:function(r){return"属性 ".concat(r,": 缺少数据")}},{key:"propRestrictHint",value:function(r){return"属性 ".concat(r," 不允许")}},{key:"elementNeedHint",value:function(r){return"第 ".concat(r," 项: 缺少数据")}},{key:"verifyErrorHint",value:function(r,t,n){return"".concat(r?r+" ":"","校验不通过, 错误信息：").concat(t||n||"未知")}}]),n}()),x={string:"string",number:"number",object:"object",array:"array",function:"function",boolean:"boolean",null:"null"},_="index",I="required",S="type",V="schema",R="custom",L="hint",A="pattern",$="length",T="minLength",F="maxLength",M="min",q="max",z="enum",D="match",Z="range",C="integer",U="natural",B="restrict",J="props",G="elements",K=[_,I,S,V,R,L],Q={string:[A,$,z,D,T,F],number:[Z,C,U,z,M,q],object:[B,J],array:[G,$,T,F],function:[],boolean:[],null:[]},W=K.slice(0,K.length-2),X=function(r,t,n){var e=!1;switch(t){case x.string:e=w.string.is(r);break;case x.number:e=w.number.is(r);break;case x.object:e=w.object.is(r);break;case x.array:e=w.array.is(r);break;case x.function:e=w.func.is(r);break;case x.boolean:e=w.boolean.is(r);break;case x.null:e=w.nul.is(r)}if(!e)throw new Error(k.verifyErrorHint(S,n,k.typeNeedHint(t)));return!0},Y=function(r,t,n,e){if(!t)return!0;var i=Object.keys(r),o=[],a=!0,u=!1,c=void 0;try{for(var s,f=n[Symbol.iterator]();!(a=(s=f.next()).done);a=!0){var l=s.value;w.object.is(l)&&o.push(l.index),w.array.is(l)&&o.push(l[0].index)}}catch(r){u=!0,c=r}finally{try{a||null==f.return||f.return()}finally{if(u)throw c}}o=o.filter((function(r){return r}));for(var y=0,p=i;p.length>y;y++){var m=p[y];if(!o.includes(m))throw new Error(k.verifyErrorHint(B,e,k.propRestrictHint(m)))}return!0},rr=function(r,t,n){var e=(H[t]||{}).is;if(!("function"==typeof e&&e.call(H[t],r)))throw new Error(k.verifyErrorHint(A,n,k.patternNeedHint(t)));return!0},tr=function(r,t,n){var e=t.min,i=t.max,o=r.length;if(w.number.is(e)&&e>o)throw new Error(k.verifyErrorHint($,n,k.minLenHint(e)));if(w.number.is(i)&&o>i)throw new Error(k.verifyErrorHint($,n,k.maxLenHint(i)));return!0},nr=function(r,t,n){if(!t.includes(r))throw new Error(k.verifyErrorHint(z,n,k.enumHint(r)));return!0},er=function(r,t,n){if(t&&!w.number.isInteger(r))throw new Error(k.verifyErrorHint(C,n,k.integerHint(r)));return!0},ir=function(r,t,n){if(t&&!w.number.isNatural(r))throw new Error(k.verifyErrorHint(U,n,k.naturalHint(r)));return!0},or=function(r,t,n){if(w.string.is(t)&&(t=new RegExp(t)),!t.test(r))throw new Error(k.verifyErrorHint(D,n,k.matchHint(r)));return!0},ar=function(r,t,n){var e=t.min,i=t.max;if(w.number.is(e)&&e>r)throw new Error(k.verifyErrorHint(Z,n,k.minValueHint(e)));if(w.number.is(i)&&r>i)throw new Error(k.verifyErrorHint(Z,n,k.maxValueHint(i)));return!0},ur=function(r,t,n){var e=function(t,e,i){var o,a;if(w.array.isNotEmpty(e)){var u=e[0];o=u.required,a=w.object.safe(u.hint)}else o=e.required,a=w.object.safe(e.hint);var c=a[I]||(n===x.object?k.propNeedHint:k.elementNeedHint)(i);if(!function(r,t,n,e){if(w.object.is(r)&&!r.hasOwnProperty(t)||w.array.is(r)&&w.undefined.is(r[t])){if(n)throw new Error(e);return!0}return!1}(r,i,o,c))try{fr(t,e,r)}catch(r){throw new Error((n===x.object?k.propErrorHint:k.elementErrorHint)(i,r))}},i=function(t,i){var o,a;if(w.array.isNotEmpty(t)){var u=t[0];o=u.required,a=w.object.safe(u.hint)}else o=t.required,a=w.object.safe(t.hint);var c=n===x.object?Object.keys(r):Array.from("a".repeat(r.length)).map((function(r,t){return t}));if(o&&0>=c.length)throw new Error(a[I]||(n===x.object?k.propEmptyHint:k.elementEmptyHint));var s=!0,f=!1,l=void 0;try{for(var y,p=c[Symbol.iterator]();!(s=(y=p.next()).done);s=!0){var m=y.value;if(!i[m])e(r[m],t,m),i[m]=!0}}catch(r){f=!0,l=r}finally{try{s||null==p.return||p.return()}finally{if(f)throw l}}};try{!function(t){var n={},o=!0,a=!1,u=void 0;try{for(var c,s=t[Symbol.iterator]();!(o=(c=s.next()).done);o=!0){var f=c.value,l=void 0;if(w.array.isNotEmpty(f))l=f[0].index;else l=f.index;if(w.number.isNatural(l)||w.string.isNotEmpty(l))e(r[l],f,l),n[l]=!0;else i(f,n)}}catch(r){a=!0,u=r}finally{try{o||null==s.return||s.return()}finally{if(a)throw u}}}(t)}catch(r){throw r}},cr=function(r,t,n,e){try{t.verify(r,!0,e)}catch(r){throw new Error(k.verifyErrorHint(V,n||"".concat(k.safeErrorHint(r))))}return!0},sr=function(r,t,n,e){try{if(!w.func.safe(t)(r,e))throw new Error(n||"未知")}catch(r){throw new Error(k.verifyErrorHint(R,"".concat(k.safeErrorHint(r))))}return!0},fr=function(r,t,n){var e=function(t){try{!function(r,t,n){try{!function(){var e=w.object.safe(t.hint),i=t.type,o=[].concat(W,Q[i]);o.push(R);var a=!0,u=!1,c=void 0;try{for(var s,f=o[Symbol.iterator]();!(a=(s=f.next()).done);a=!0){var l=s.value;if(t.hasOwnProperty(l)){var y=t[l],p=t.props,m=e[l];switch(l){case S:X(r,y,m);break;case B:Y(r,y,p,m);break;case A:rr(r,y,m);break;case $:tr(r,y,m);break;case z:nr(r,y,m);break;case D:or(r,y,m);break;case Z:ar(r,y,m);break;case C:er(r,y,m);break;case U:ir(r,y,m);break;case G:case J:ur(r,y,i);break;case V:cr(r,y,m,n);break;case R:sr(r,y,m,n)}}}}catch(r){u=!0,c=r}finally{try{a||null==f.return||f.return()}finally{if(u)throw c}}}()}catch(r){throw r}}(r,t,n)}catch(r){throw r}};if(w.object.is(t)&&e(t),w.array.is(t)){for(var i=[],o=0;t.length>o;o++)try{e(t[o]);break}catch(r){i.push("schema-".concat(o,": ").concat(k.safeErrorHint(r)))}if(t.length===i.length)throw new Error(i.join(";"))}return!0},lr=new(function(r){function n(){var r;return t(this,n),(r=u(this,o(n).call(this))).propsInfoEmpty="属性信息不能为空",r.emptyLengthInfo="空的长度信息",r.emptyEnumInfo="空的枚举信息",r.errorEnumInfo="错误的枚举信息",r.emptyHintInfo="空的提示信息",r.emptyRangeInfo="空的范围信息",r}return i(n,P),e(n,[{key:"unIdentifyType",value:function(r){return"不可识别的属性类型：".concat(r)}},{key:"illegalHintInfo",value:function(r){return"非法的提示信息属性：".concat(r)}},{key:"illegalVerifyProps",value:function(r){return"非法的校验属性：".concat(r)}},{key:"illegalPatternType",value:function(r){return"非法的格式类型：".concat(r)}}]),n}()),yr=Object.keys(H),pr=function(r){var t=r[$];if(!w.object.isNotEmpty(t)&&!w.number.isNatural(t))throw new Error(lr.emptyLengthInfo);if(w.number.isNatural(t))r[$]={min:t,max:t};else if(w.object.isNotEmpty(t)){if(!w.number.isNatural(t.min)&&!w.number.isNatural(t.max))throw new Error(lr.emptyLengthInfo);w.number.isNatural(t.min)||delete t.min,w.number.isNatural(t.max)||delete t.max}},mr=function(r,t){var n,e=r[z];if(w.object.isNotEmpty(e)&&(n=Object.keys(e).map((function(r){return e[r]}))),w.array.isNotEmpty(e)&&(n=e),!w.array.isNotEmpty(n))throw new Error(lr.emptyEnumInfo);var i=n.every((function(r){return w.number.is(r)})),o=n.every((function(r){return w.string.is(r)}));if(!i&&t)throw new Error(lr.errorEnumInfo);if(!o&&!t)throw new Error(lr.errorEnumInfo);r[z]=n},br=function(r){if(r.hasOwnProperty(T)){var t=r[T];if(w.number.isNatural(t)){var n=r[$],e={min:t};r[$]=w.object.is(n)?Object.assign({},n,e):e,delete r[T]}}if(r.hasOwnProperty(F)){var i=r[F];if(w.number.isNatural(i)){var o=r[$],a={max:i};r[$]=w.object.is(o)?Object.assign({},o,a):a,delete r[F]}}},hr=function r(t){if(w.object.isNot(t)&&!w.array.isNotEmpty(t))throw new Error(lr.propsInfoEmpty);if(w.array.is(t)){for(var n=[],e=0;t.length>e;e++)n[e]=r(t[e]);return n}if(t instanceof jr&&(t={schema:t}),t.hasOwnProperty(V)){var i=t[V];if(w.object.isNot(i)||!(i instanceof jr))throw new Error(lr.illegalVerifyProps(V));for(var o=i.info,a=0,u=[S,I,_];u.length>a;a++){var c=u[a];!t.hasOwnProperty(c)&&o.hasOwnProperty(c)&&(t[c]=o[c])}}var s=Object.assign({},t);return wr(s)},wr=function(r){switch(r.type){case x.string:case String:(r=vr(r)).type=x.string;break;case x.number:case Number:(r=gr(r)).type=x.number;break;case x.object:case Object:(r=Nr(r)).type=x.object;break;case x.array:case Array:(r=dr(r)).type=x.array;break;case x.function:case Function:r.type=x.function;break;case x.boolean:case Boolean:r.type=x.boolean;break;case x.null:case null:r.type=x.null}return Er(r)},Er=function(r){var t=Q[r.type];if(w.array.isNot(t))throw new Error(lr.unIdentifyType(t));for(var n=0,e=Object.keys(r);e.length>n;n++){var i=e[n];if(!K.includes(i)&&!t.includes(i))throw new Error(lr.illegalVerifyProps(i))}if(r.hasOwnProperty(L)){var o=r[L];if(!w.object.is(o))throw new Error(lr.illegalVerifyProps(L));for(var a=0,u=Object.keys(o);u.length>a;a++){var c=u[a];if(!K.includes(c)&&!t.includes(c))throw new Error(lr.illegalHintInfo(c))}}if(r.hasOwnProperty(R)&&w.func.isNot(r[R]))throw new Error(lr.illegalVerifyProps(R));if(r.hasOwnProperty(_)){var s=r[_];if(w.string.isNot(s)&&w.number.isNot(s))throw new Error(lr.illegalVerifyProps(_))}return r},vr=function(r){if(r.hasOwnProperty(A)){var t=r[A];if(!yr.includes(t))throw new Error(lr.illegalPatternType(t))}if(br(r),r.hasOwnProperty($)&&pr(r),r.hasOwnProperty(z)&&mr(r),r.hasOwnProperty(D)){var n=r[D];if(!(w.string.isNotEmpty(n)||n instanceof RegExp))throw new Error(lr.illegalVerifyProps(D))}return r},gr=function(r){if(r.hasOwnProperty(M)){var t=r[M];if(w.number.isNatural(t)){var n=r[Z],e={min:t};r[Z]=w.object.is(n)?Object.assign({},n,e):e,delete r[M]}}if(r.hasOwnProperty(q)){var i=r[q];if(w.number.isNatural(i)){var o=r[Z],a={max:i};r[Z]=w.object.is(o)?Object.assign({},o,a):a,delete r[q]}}if(r.hasOwnProperty(Z)){var u=r[Z];if(w.object.isEmpty(u))throw new Error(lr.emptyRangeInfo);if(w.number.isNot(u.min)&&w.number.isNot(u.max))throw new Error(lr.emptyRangeInfo);u.min=+u.min,u.max=+u.max}if(r.hasOwnProperty(C)&&w.boolean.isNot(r[C]))throw new Error(lr.illegalVerifyProps(C));if(r.hasOwnProperty(U)&&w.boolean.isNot(r[U]))throw new Error(lr.illegalVerifyProps(U));return r.hasOwnProperty(z)&&mr(r,!0),r},Nr=function(r){if(r.hasOwnProperty(J)){var t=r[J];if(!w.object.isNotEmpty(t)&&!w.array.is(t))throw new Error(lr.illegalVerifyProps(J));var n=function(r,t){var n=r.reduce((function(r,t){var n;if(w.object.is(t)&&t.hasOwnProperty(_)&&!w.string.isNotEmpty(n=t[_])&&!w.number.is(n))throw new Error(lr.illegalVerifyProps(_));return w.array.is(t)&&w.object.is(t[0])&&(w.string.isNotEmpty(n=t[0][_])||delete t[0][_]),w.string.isNotEmpty(n)||(n="$_PROPS_ELEMENTS_DEFAULT_SCHEME_INFO"),r[n]=hr(t),r}),{});t[J]=Object.keys(n).map((function(r){return n[r]}))};w.object.isNotEmpty(t)?function(r,t){!(w.func.isNot(r[S])&&w.nul.isNot(r[S])&&w.string.isNot(x[r[S]]))||r.hasOwnProperty(V)||r instanceof jr?(delete r[_],t.props=[hr(r)]):(r=Object.keys(r).map((function(t){var n=r[t];return"$_PROPS_DEFAULT_INFO"===t||(w.object.is(n)&&(n[_]=t),w.array.is(n)&&w.object.is(n[0])&&(n[0][_]=t)),n})),n(r,t))}(t,r):n(t,r)}if(r.hasOwnProperty(B)){var e=r[B],i=r[J];if(w.boolean.isNot(e))throw new Error(lr.illegalVerifyProps(B));if(e&&w.array.isNot(i))throw new Error(lr.illegalVerifyProps(J))}return r},dr=function(r){if(r.hasOwnProperty(G)){var t=r[G];if(!w.object.isNotEmpty(t)&&!w.array.is(t))throw new Error(lr.illegalVerifyProps(G));if(w.object.isNotEmpty(t))delete t.index,r.elements=[hr(t)];else{var n=t.reduce((function(r,t){var n;if(w.object.is(t)){if(t.hasOwnProperty(_)&&w.number.isNot(t.index))throw new Error(lr.illegalVerifyProps(_));n=t.index}if(w.array.is(t)&&w.object.is(t[0])){if(t[0].hasOwnProperty(_)&&w.number.isNot(t[0].index))throw new Error(lr.illegalVerifyProps(_));n=t[0].index}return w.number.isNot(n)&&(n="$_PROPS_ELEMENTS_DEFAULT_SCHEME_INFO"),r[n]=hr(t),r}),{});r[G]=Object.keys(n).map((function(r){return n[r]}))}}return br(r),r.hasOwnProperty($)&&pr(r),r},jr=function(){function r(n){t(this,r),this.info=hr(n),this.verify=this.verify.bind(this)}return e(r,[{key:"verify",value:function(r,t,n){try{return fr(r,this.info,n),!0}catch(r){if(t)throw r;return!1}}}]),r}();exports.Pattern=H,exports.Schema=jr,exports.Type=w,exports.default=jr;
